name: Despliegue a main

on:
  push:
    branches:
      - main

jobs:
  integration-test-and-deploy:
    
    runs-on: ubuntu-latest

    steps:
      
      - name: Descargar c√≥digo fuente
        uses: actions/checkout@v4

      - name: Crear archivo .env con Secretos üîê
        run: |
          echo "DB_NAME=${{ secrets.DB_NAME }}" >> .env
          echo "DB_USER=${{ secrets.DB_USER }}" >> .env
          echo "DB_PASSWORD=${{ secrets.DB_PASSWORD }}" >> .env
          echo "DB_ROOT_PASSWORD=${{ secrets.DB_ROOT_PASSWORD }}" >> .env
          echo "DB_HOST=db" >> .env

      - name: Levantar entorno y correr pruebas de integraci√≥n 
        run: docker compose up --build --exit-code-from tester

      
      - name: Apagar contenedores 
        if: always() 
        run: docker compose down
      
      
      - name: Simular Deploy a Desarrollo 
        run: echo "Tests exitosos. Iniciando despliegue a servidor de desarrollo..."